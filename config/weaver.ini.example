# NOTE: This configuration file is employed by Travis-CI smoke test to immediately identify any problematic setting.

###
# app configuration
# http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/environment.html
###

[app:main]
use = egg:weaver

pyramid.reload_templates = false
pyramid.debug_authorization = false
pyramid.debug_notfound = false
pyramid.debug_routematch = false
pyramid.default_locale_name = en

# mongodb
mongodb.host = mongodb
mongodb.port = 27017
mongodb.db_name = weaver

# NOTE:
#   For all below parameters, settings suffixed by `_url` are automatically generated from their corresponding `_path`
#   settings using `weaver.url` if they are not provided. Otherwise, the explicit definition provided by `_url` suffixed
#   setting is used. The obtained full URL (either generated or explicitly provided) are used for response body values
#   and for external monitoring, resource access, etc. while the `_path` suffixed settings are used internally.
#
#   Providing explicit `_url` settings that differ from the generated result of `weaver.url`+`_path` therefore allows
#   you to configure the application to report different *external* routes than the *internal* ones, allowing to define,
#   amongst other things, secured access points or other advanced server-side behaviour, but it then becomes your
#   responsibility to correctly map your server routes to internal routes after applying the server-side operation.

# --- Weaver Configuration ---
weaver.configuration = ems
weaver.url = http://localhost:4001

# --- Weaver requests extension flags ---
# SSL verification should be enabled for secured connections
# setting is available for convenience, debug purposes and local environments
# preferably, use specific request options
weaver.ssl_verify = true
# file with request options to be used with 'weaver.utils.request_extra'
# see 'requests_options.yml.example'
weaver.request_options =

# --- Weaver CWL settings ---
# NOTE: [experimental]
# enforce provided effective user/group identifiers for Application Package execution
# values must be resolved as integers
# (default: use cwltool auto-resolution according to running machine and current user/group)
weaver.cwl_euid =
weaver.cwl_egid =

# --- Weaver WPS settings ---
weaver.wps = true
weaver.wps_url =
weaver.wps_path = /ows/wps
weaver.wps_output = true
weaver.wps_output_dir = /tmp
weaver.wps_output_url =
weaver.wps_output_path = /wpsoutputs
weaver.wps_workdir =

# --- Weaver WPS metadata ---
# all attributes under "metadata:main" can be specified as 'weaver.wps_metadata_<field>'
# (reference: https://pywps.readthedocs.io/en/master/configuration.html#metadata-main)
weaver.wps_metadata_identification_title=Weaver
weaver.wps_metadata_identification_abstract=Weaver internal WPS used for demo and testing.
weaver.wps_metadata_identification_keywords=Weaver,WPS,OGC
weaver.wps_metadata_identification_accessconstraints=NONE
weaver.wps_metadata_provider_name=CRIM
weaver.wps_metadata_provider_url=http://pavics-weaver.readthedocs.org/en/latest/

# --- Weaver WPS REST API ---
weaver.wps_restapi = true
weaver.wps_restapi_url =
weaver.wps_restapi_path = /
weaver.wps_restapi_ref = https://app.swaggerhub.com/apis/geoprocessing/WPS/
weaver.wps_restapi_doc = https://raw.githubusercontent.com/opengeospatial/wps-rest-binding/develop/docs/18-062.pdf

# --- Weaver job email notification ---
weaver.wps_email_encrypt_salt = salty-email
weaver.wps_email_encrypt_rounds = 100000
weaver.wps_email_notify_smtp_host =
weaver.wps_email_notify_from_addr = example@email.com
weaver.wps_email_notify_password = 123456
weaver.wps_email_notify_port = 25
weaver.wps_email_notify_ssl = true
weaver.wps_email_notify_template_dir =
weaver.wps_email_notify_template_default =

# --- Weaver other configurations ---
# additional processes to load at startup (see 'wps_processes.yml.example')
weaver.wps_processes_file = wps_processes.yml
# known remote ADES for processes redirection based on data-sources when using EMS configuration
# (see 'data_sources.json.example' and 'weaver.processes.sources' for more details)
weaver.data_sources = data_sources.json
# comma-separated list of key=value options to add to settings
weaver.extra_options =

###
# celery scheduler config
# https://pypi.python.org/pypi/pyramid_celery
###
[celery]
#USE_CELERYCONFIG = True
BROKER_URL = mongodb://mongodb:27017/celery

###
# wsgi server configuration
###

[server:main]
use = egg:gunicorn#main
bind = 0.0.0.0:4001
workers = 5
timeout = 10

###
# logging configuration
# http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/logging.html
###

[loggers]
keys = root, weaver, celery, cwltool

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = INFO
handlers = console

[logger_weaver]
level = INFO
handlers = console
qualname = weaver
propagate = 0

[logger_celery]
level = INFO
handlers = console
qualname = celery
propagate = 0

[logger_cwltool]
level = INFO
handlers = console
qualname = cwltool
propagate = 0

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = [%(asctime)s] %(levelname)-8.8s [%(threadName)s][%(name)s] %(message)s
